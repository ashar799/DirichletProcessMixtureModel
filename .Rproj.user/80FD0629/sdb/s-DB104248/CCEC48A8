{
    "contents" : "rm (list = ls())\nsetwd(\"/home/bit/ashar/Dropbox/Pathway\")\npath.names <- list.files(\"/home/bit/ashar/Dropbox/Pathway/KEGG_Metabolic\")\n\npath.names <- gsub(pattern = \".sbml.xml\",replacement= \"\", path.names)\npath.names <- paste(path.names,\".sbml_diseaseCompleteGenes.txt\", sep = \"\")\n\nsetwd(\"/home/bit/ashar/Dropbox/Pathway/Output_KT\")\nsetwd(\"/home/bit/ashar/Dropbox/Pathway\")\nexprs <- read.csv('/home/bit/ashar/Dropbox/Pathway/UNC202.txt', sep = '\\t', header = FALSE)\npatient.names <- exprs[1,]\nexprs <- exprs[-1,]\npatient.names <- patient.names[-1]\nnames <- as.character(unlist(patient.names))\n\nq <- strsplit(names,\"-01A\")\nnames.q <- c(0)\nfor ( i in 1:length(q)){\n  names.q <- c(names.q,q[[i]][1]) \n}\nnames.q <- gsub(\"-01B-01\",\"\",names.q)\nnames.q <- gsub(\"-01C-01\",\"\",names.q)\nnames.q <- names.q[-1]\n\n\n## REad PhenoData\nlibrary('xlsx')\npheno <- read.xlsx(\"survival.xls\", sheetIndex =1)\npheno[,1] <- as.character(as.matrix(pheno[,1]))\n\n\n## Arranging the expression object to have the same order as the \nexprs.ready <- exprs[2:11863,2:203]\nrownames(exprs.ready) <- as.character(exprs[2:11863,1])\ncolnames(exprs.ready) <- names.q\n\nexprs.norm <- t(exprs.ready)\n\nmt <- match(rownames(exprs.norm),pheno[,1])\npheno <- pheno[mt,] \n\n\n## Taking the log transform of the data\nind.na <- which(as.vector(pheno[,3])== \"NA\")\nind.nna <- which(as.vector(pheno[,3])!= \"NA\")\n\ntemplog <- as.numeric(as.vector(pheno[ind.nna,3]))\ntemplog <- log(templog)\n\npheno[,3] <- as.vector(pheno[,3])\n\npheno[ind.nna,3] <- templog\npheno[ind.na,3] <- NA\n\npheno[,3] <- as.numeric(as.matrix(pheno[,3]))\n\n## Expression Object is Ready\n\n\n## Delete Those Patients which have NA\npheno <- pheno[-ind.na,]\nexprs.norm <- exprs.norm[-ind.na,]\n\n\nsurv <- Surv(time = pheno[,3], event = pheno[,2])\n\n\nlibrary(globaltest)\nlibrary(org.Hs.eg.db)\nlibrary(KEGG.db)\nexprs.norm <- as.matrix(as.data.frame(exprs.norm))\nclass(exprs.norm) <- \"numeric\"\nxx <- as.list(org.Hs.egALIAS2EG)\n# Remove pathway identifiers that do not map to any entrez gene id\nxx <- xx[!is.na(xx)]\n\nglob <- gtKEGG( pheno[,3], (exprs.norm), annotation = 'org.Hs.eg.db', multtest = \"BH\",probe2entrez = xx)\n\n\npathway.names <- names(glob)[1:30]\n\nyy <- as.list(KEGGPATHID2EXTID)\n\n######### TO GET GENE NAMES of GENES WITHIN PATHWAYS ##############################3\n\n# For the reverse map:\n# Convert the object to a list\ndd <- as.list(org.Hs.egPATH2EG)\n# Remove pathway identifiers that do not map to any entrez gene id\ndd <- dd[!is.na(dd)]\nif(length(dd) > 0){\n  # The entrez gene identifiers for the first two elements of XX\n  dd[1:2]\n  # Get the first one\n  dd[[1]]\n}\n\npath2entrez <- dd\n\npath2entrez.subset <- path2entrez[pathway.names]\n\nlibrary('biomaRt')\n# listDatasets(ensembl)\nensembl = useMart('ensembl')\nensembl = useDataset(\"hsapiens_gene_ensembl\",mart=ensembl)\n\nnames.genes <- list(0)\nfor( i in 1:length(pathway.names)){\nnames.genes[[i]] = getBM(attributes = c(\"entrezgene\",\"hgnc_symbol\"), filters = \"entrezgene\",values =path2entrez.subset[i], mart=ensembl)\n}\n\n### Data frame FROM the EXPRESSION #################\n\ndata.exprs <- as.data.frame(exprs.norm)\ndata.subsets <- list(0)\nfor ( i in 1:length(pathway.names) ){\n\n  temp.names <- names.genes[[i]][,2][c(names.genes[[i]][,2])%in% colnames(data.exprs)]\n  data.subsets[[i]] <- as.data.frame(data.exprs[, temp.names]) \n}\n\ndata.combined <- matrix(0, nrow = nrow(data.exprs), ncol =length(pathway.names) )\nfor ( i in 1:length(pathway.names)){\n  data.combined[,i] <- as.vector(apply(data.subsets[[i]],1, mean))\n  }\nrownames(data.combined) <- rownames(data.exprs)\ncolnames(data.combined) <- pathway.names\n\n########################################################################\n#########################################################################\n\nsave(data.combined,file = '30pathway.RData')\n\n",
    "created" : 1428423927465.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2891097297",
    "id" : "CCEC48A8",
    "lastKnownWriteTime" : 1428491912,
    "path" : "~/Dropbox/Pathway/pathwayscores.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}